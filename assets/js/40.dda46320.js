(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{317:function(_,v,t){"use strict";t.r(v);var e=t(14),r=Object(e.a)({},(function(){var _=this,v=_._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("h1",{attrs:{id:"虚拟内存空间分布图"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#虚拟内存空间分布图"}},[_._v("#")]),_._v(" 虚拟内存空间分布图")]),_._v(" "),v("h2",{attrs:{id:"_1-学习意义"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-学习意义"}},[_._v("#")]),_._v(" 1.学习意义")]),_._v(" "),v("p",[_._v("1.C语言和"),v("code",[_._v("C++")]),_._v("底层原理分析利器"),v("br"),_._v("\n2.将我学过的"),v("code",[_._v("计算机组成原理")]),_._v("，"),v("code",[_._v("汇编")]),_._v("，"),v("code",[_._v("C语言")]),_._v("，"),v("code",[_._v("C++")]),_._v("和"),v("code",[_._v("操作系统")]),_._v("能够很好的串起来")]),_._v(" "),v("h2",{attrs:{id:"_2-程序加载-后-的虚拟内存分布✔️"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-程序加载-后-的虚拟内存分布✔️"}},[_._v("#")]),_._v(' 2.程序加载"后"的虚拟内存分布✔️')]),_._v(" "),v("ul",[v("li",[_._v("环境：\n"),v("ul",[v("li",[_._v("CPU：32位X86的物理机器")]),_._v(" "),v("li",[_._v("OS：Linux")]),_._v(" "),v("li",[_._v("ELF格式文件")])])])]),_._v(" "),v("h3",{attrs:{id:"_2-1-虚拟内存空间-大致分布"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-虚拟内存空间-大致分布"}},[_._v("#")]),_._v(' 2.1."虚拟内存空间"大致分布')]),_._v(" "),v("p",[v("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/HACV/picture/img/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4%E5%88%86%E5%B8%83%E6%89%8B%E7%BB%9801.png",alt:"虚拟内存空间分布手绘01"}})]),_._v(" "),v("h3",{attrs:{id:"_2-2-从下到上进行说明"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-从下到上进行说明"}},[_._v("#")]),_._v(" 2.2.从下到上进行说明")]),_._v(" "),v("hr"),_._v(" "),v("ul",[v("li",[_._v("内核区：kernel映射到进程虚拟内存，但程序无法访问")]),_._v(" "),v("li",[v("code",[_._v("argv")]),_._v(","),v("code",[_._v("environ")]),_._v(":命令行参数和环境变量\n"),v("ul",[v("li",[_._v("其实就比如 "),v("code",[_._v("ping -t www.baidu.com")]),_._v("，我们也可以写命令行的参数")])])]),_._v(" "),v("li",[_._v("Stack（栈/堆栈，向低地址生长）：\n"),v("ul",[v("li",[_._v("程序中，『非静态的局部变量』放的地方")]),_._v(" "),v("li",[_._v("吐槽，叫栈就好了，前面还加个堆，以前入门的时候，还在这个到底是堆，还是栈。。。")])])]),_._v(" "),v("li",[_._v("共享库：\n"),v("ul",[v("li",[_._v("比如，Linux你所制作的.so（动态库），加载的位置就是在这。")]),_._v(" "),v("li",[_._v("内存映射段，文件映射（包括动态库）和匿名映射。示例：/lib/libc。所以")])])]),_._v(" "),v("li",[_._v("heap（堆，向高地址生长）：\n"),v("ul",[v("li",[_._v("比如C语言中"),v("code",[_._v("malloc")]),_._v("的，"),v("code",[_._v("C++")]),_._v("中"),v("code",[_._v("new")])]),_._v(" "),v("li",[_._v("吐槽：这个堆和数据结构中的堆不一样，弄得那时候先学数据结构的我，看到这个，条件反射问最大堆还是最小堆...最后发现都不是..")])])])]),_._v(" "),v("hr"),_._v(" "),v("ul",[v("li",[v("code",[_._v(".bss")]),_._v("：\n"),v("ul",[v("li",[_._v("『未初始化』的"),v("code",[_._v("全局变量")]),_._v("和"),v("code",[_._v("静态变量（全局+局部）")])]),_._v(" "),v("li",[_._v("存放程序中『初始化为0』的"),v("code",[_._v("全局变量")]),_._v("和"),v("code",[_._v("静态变量（全局+局部）")]),v("font",{staticStyle:{background:"yellow"}},[_._v("听说这样放的原因是：初始化为0，这个可以被优化为这个")])],1)])]),_._v(" "),v("li",[_._v("."),v("code",[_._v("data")]),_._v("（数据段）:\n"),v("ul",[v("li",[_._v("存放『已初始化』的"),v("code",[_._v("全局变量")]),_._v("和"),v("code",[_._v("静态变量（全局+局部）")])])])])]),_._v(" "),v("hr"),_._v(" "),v("ul",[v("li",[v("code",[_._v(".rodata")]),_._v("（只读存储区，有书叫常量区）:\n"),v("ul",[v("li",[_._v("比如存放，『字符产常量』")])])]),_._v(" "),v("li",[v("code",[_._v(".text")]),_._v("（代码段，还叫"),v("code",[_._v(".code")]),_._v("）:\n"),v("ul",[v("li",[_._v("程序源代码编译之后的机器指令，放在这个代码段")]),_._v(" "),v("li",[_._v("吐槽：有的书上，把"),v("code",[_._v(".rodata")]),_._v("和"),v("code",[_._v(".text")]),_._v("统称为代码段，这些规定还真是。")])])])]),_._v(" "),v("hr"),_._v(" "),v("ul",[v("li",[_._v("其实这里，还有一个保留区：禁止访问，这也解释了我们\n"),v("ul",[v("li",[_._v("为什么不能给地址为0的地方写数据，不然就会产生段错误。")])])])]),_._v(" "),v("hr"),_._v(" "),v("p",[v("font",{staticStyle:{background:"yellow"}},[_._v("注意")]),_._v("：")],1),_._v(" "),v("ul",[v("li",[_._v("1.我为什么要将"),v("code",[_._v(".rodata")]),_._v("和"),v("code",[_._v(".text")]),_._v("这么画呢?\n"),v("ul",[v("li",[_._v("因为这两段区域的权限是read only的"),v("br"),_._v("\n将来在"),v("code",[_._v("链接")]),_._v("的时候，会把他们完成数据段合并，合并到一块")])])]),_._v(" "),v("li",[_._v("2.其实ELF文件，映射到虚拟内存空间（不存在，假象的，但是用来分析进程很有用）"),v("br"),_._v("\n不止以上，我画的这几个段，但那些和我们编程无关的话，比如，调试段，我们就没画了")]),_._v(" "),v("li",[_._v("3."),v("font",{staticStyle:{background:"yellow"}},[_._v("我们在分析C语言和C++的底层原理的时候，用上面的粗略的就完全足够了，没必要用太详细的")])],1)]),_._v(" "),v("h2",{attrs:{id:"_3-虚拟内存空间-物理内存空间"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-虚拟内存空间-物理内存空间"}},[_._v("#")]),_._v(" 3.虚拟内存空间+物理内存空间")]),_._v(" "),v("p",[_._v("计算机工作流程")]),_._v(" "),v("ul",[v("li",[_._v("程序→加载后→进程（进程实际不存在）")]),_._v(" "),v("li",[_._v("（虚拟内存空间→映射→物理内存空间）")])]),_._v(" "),v("blockquote",[v("p",[_._v("以Linux系统为例")])]),_._v(" "),v("ul",[v("li",[v("p",[_._v("程序：比如，编译后的可执行文件"),v("code",[_._v("a.out")]),_._v("，是用"),v("strong",[_._v("ELF格式")]),_._v("存储")])]),_._v(" "),v("li",[v("p",[_._v("注意：进程是"),v("strong",[_._v("不存在实体")]),_._v("的，但是我们可以通过，虚拟内存"),v("strong",[_._v("实际上是不存在实体")]),_._v("的，但是引入这个抽象的概念，能够简化我们汇编编程，C语言编程等程序设计。")]),_._v(" "),v("ul",[v("li",[_._v("正是因为有虚拟内存，所以，我们才能在物理内存少于虚拟内存的地方，还能跑起来程序")])])]),_._v(" "),v("li",[v("p",[_._v("物理内存空间：也就是我们的内存条，是"),v("strong",[_._v("实际存在")]),_._v("的。")])])]),_._v(" "),v("p",[_._v("补充：")]),_._v(" "),v("ul",[v("li",[v("p",[_._v("我们想要获取进程的"),v("code",[_._v("进程id")]),_._v("啥的，可以通过"),v("code",[_._v("内核区")]),_._v("的"),v("strong",[_._v("PCB")])])]),_._v(" "),v("li",[v("p",[v("code",[_._v("虚拟内存")]),_._v("如何映射到"),v("code",[_._v("实际(物理）内存")]),_._v("？")]),_._v(" "),v("ul",[v("li",[_._v("通过CPU中，有个硬件叫做"),v("code",[_._v("MMU")])])])]),_._v(" "),v("li",[v("p",[_._v("如果r和w权限和r权限的那两个段的大小允许的话")]),_._v(" "),v("ul",[v("li",[_._v("我们会把他放到一个**page(页）**里面，在我们32位机上，一个页面的大小，是4KB，这样的目的是为了节省内存，节省空问")])])])]),_._v(" "),v("h2",{attrs:{id:"_4-关于-虚拟内存空间-的画法"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-关于-虚拟内存空间-的画法"}},[_._v("#")]),_._v(' 4.关于"虚拟内存空间"的画法')]),_._v(" "),v("blockquote",[v("p",[_._v("下面展示了其他书籍上，关于"),v("strong",[_._v("虚拟内存空间")]),_._v("的画法")])]),_._v(" "),v("ul",[v("li",[_._v("《程序员的自我修养》P167")])]),_._v(" "),v("p",[v("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/HACV/picture/img/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4%E5%88%86%E5%B8%8302.png",alt:"虚拟内存空间分布02"}})]),_._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"https://www.zhihu.com/question/36103513",target:"_blank",rel:"noopener noreferrer"}},[_._v("知乎"),v("OutboundLink")],1),_._v("具体链接到一个国外的："),v("a",{attrs:{href:"https://manybutfinite.com/post/anatomy-of-a-program-in-memory/",target:"_blank",rel:"noopener noreferrer"}},[_._v("https://manybutfinite.com/post/anatomy-of-a-program-in-memory/"),v("OutboundLink")],1)])]),_._v(" "),v("p",[v("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/HACV/picture/img/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4%E5%88%86%E5%B8%83%E7%9F%A5%E4%B9%8E03.png",alt:"虚拟内存空间分布知乎03"}})]),_._v(" "),v("ul",[v("li",[v("p",[_._v("说明的问题：")])]),_._v(" "),v("li",[v("p",[_._v("栈的生长方式等的争论，这个其实取决于操作系统和硬件实现，但是"),v("strong",[_._v("业界目前面试等时候，还是默认用大多数机型的")]),_._v("，我前面写的那种的方式。")])]),_._v(" "),v("li",[v("p",[_._v("《CSAPP（深入理解计算机系统）》原书第2版，中文P554")])])]),_._v(" "),v("p",[v("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/HACV/picture/img/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4%E5%88%86%E5%B8%83CSAPP04.png",alt:"虚拟内存空间分布CSAPP04"}})]),_._v(" "),v("h2",{attrs:{id:"参考资料"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[_._v("#")]),_._v(" 参考资料")]),_._v(" "),v("ul",[v("li",[_._v("俞甲子 / 石凡 / 潘爱民《"),v("a",{attrs:{href:"https://book.douban.com/subject/3652388/",target:"_blank",rel:"noopener noreferrer"}},[_._v("程序员的自我修养"),v("OutboundLink")],1),_._v("》，")]),_._v(" "),v("li",[_._v("《程序员的自我修养》—全书思维导图，"),v("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/111682188",target:"_blank",rel:"noopener noreferrer"}},[_._v("博客"),v("OutboundLink")],1),_._v("，知乎")])])])}),[],!1,null,null,null);v.default=r.exports}}]);