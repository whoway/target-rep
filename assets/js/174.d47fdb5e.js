(window.webpackJsonp=window.webpackJsonp||[]).push([[174],{459:function(s,a,t){"use strict";t.r(a);var n=t(14),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"llvm的cookbook中文版"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#llvm的cookbook中文版"}},[s._v("#")]),s._v(" LLVM的CookBook中文版")]),s._v(" "),a("h2",{attrs:{id:"目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目录"}},[s._v("#")]),s._v(" 目录")]),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#目录"}},[s._v("目录")])]),a("li",[a("a",{attrs:{href:"#_1-第1章-llvm设计与使用"}},[s._v("1.第1章-llvm设计与使用")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-2-模块化设计"}},[s._v("1.2.模块化设计")])]),a("li",[a("a",{attrs:{href:"#_1-3交叉编译clang-llvm🧩"}},[s._v("1.3交叉编译Clang/LLVM🧩")])]),a("li",[a("a",{attrs:{href:"#_1-4-clang将c源码转换为llvm汇编码"}},[s._v("1.4.clang将C源码转换为LLVM汇编码")])]),a("li",[a("a",{attrs:{href:"#_1-5-将llvm-ir转换为bitcode「正面」"}},[s._v("1.5.将LLVM_IR转换为bitcode「正面」")])]),a("li",[a("a",{attrs:{href:"#_1-6-将llvm-bitcode转换为目标平台汇编码"}},[s._v("1.6.将LLVM bitcode转换为目标平台汇编码")])]),a("li",[a("a",{attrs:{href:"#_1-7-将llvm-bitcode转回为llvm汇编码-也就是llvm-ir-「反面」"}},[s._v("1.7.将LLVM bitcode转回为LLVM汇编码（==也就是llvm-IR==）「反面」")])]),a("li",[a("a",{attrs:{href:"#_1-8-转换llvmir"}},[s._v("1.8.转换LLVMIR")])]),a("li",[a("a",{attrs:{href:"#_1-9-链接llvmbitcode"}},[s._v("1.9.链接LLVMbitcode")])]),a("li",[a("a",{attrs:{href:"#_1-10-执行llvm-bitcode"}},[s._v("1.10.执行LLVM bitcode")])]),a("li",[a("a",{attrs:{href:"#_1-11-clang前端的不同用途⭐️"}},[s._v("1.11.clang前端的不同用途⭐️")])]),a("li",[a("a",{attrs:{href:"#_1-12-使用go语言前端llgo🧩"}},[s._v("1.12.使用GO语言前端llgo🧩")])]),a("li",[a("a",{attrs:{href:"#_1-13-使用dragonegg🧩"}},[s._v("1.13.使用DragonEgg🧩")])])])]),a("li",[a("a",{attrs:{href:"#第2章-实现编译器前端"}},[s._v("第2章-实现编译器前端")])]),a("li",[a("a",{attrs:{href:"#第3章-扩展前端并增加jit支持"}},[s._v("第3章-扩展前端并增加JIT支持")]),a("ul",[a("li",[a("a",{attrs:{href:"#_3-5-增加jit支持"}},[s._v("3.5.增加JIT支持")])])])]),a("li",[a("a",{attrs:{href:"#第4章-准备优化⭐️"}},[s._v("第4章-准备优化⭐️")])])])]),a("p"),s._v(" "),a("p",[s._v("[TOC]")]),s._v(" "),a("h2",{attrs:{id:"_1-第1章-llvm设计与使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-第1章-llvm设计与使用"}},[s._v("#")]),s._v(" 1.第1章-llvm设计与使用")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/HACV/picture/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20221116172911.png",alt:"微信图片_20221116172911"}})]),s._v(" "),a("p",[s._v("LLVM的代码有3种表示形式：")]),s._v(" "),a("ul",[a("li",[s._v("内存编译器中的IR")]),s._v(" "),a("li",[s._v("存于磁盘的 ==bitcode==「表示："),a("code",[s._v(".bc")]),s._v("后缀」二进制文件！")]),s._v(" "),a("li",[s._v("以及用户可读的汇编码。「应该是LLVM的汇编码，"),a("code",[s._v(".ll")]),s._v("后缀？")])]),s._v(" "),a("h3",{attrs:{id:"_1-2-模块化设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-模块化设计"}},[s._v("#")]),s._v(" 1.2.模块化设计")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" llvm才能使用opt⭐️⭐️⭐️⭐️\nwhoway@ubuntu:~$ opt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\nLLVM "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("http://llvm.org/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n  LLVM version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0\n  \n  Optimized build.\n  Default target: x86_64-pc-linux-gnu\n  Host CPU: broadwell\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("opt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-instcombine")]),s._v(" testfile.ll "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" output1.ll\n\ninstruct combine \n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" 重命名\n\nopt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-deadargelim")]),s._v(" testfile.ll "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" output2.ll\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"_1-3交叉编译clang-llvm🧩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3交叉编译clang-llvm🧩"}},[s._v("#")]),s._v(" 1.3交叉编译Clang/LLVM🧩")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("whoway@ubuntu:~/llvmCookBook$ cmake "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\ncmake version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.16")]),s._v(".3\n\nCMake suite maintained and supported by Kitware "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kitware.com/cmake"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_1-4-clang将c源码转换为llvm汇编码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-clang将c源码转换为llvm汇编码"}},[s._v("#")]),s._v(" 1.4.clang将C源码转换为LLVM汇编码")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("whoway@ubuntu:~/llvmCookBook$ clang "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\n\nCommand "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'clang'")]),s._v(" not found, but can be installed with:\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" clang\nPlease ask your administrator.\n\nwhoway@ubuntu:~/llvmCookBook$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" clang \t\t⭐️⭐️⭐️\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nwhoway@ubuntu:~/llvmCookBook$ clang "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\nclang version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0-4ubuntu1 \nTarget: x86_64-pc-linux-gnu\nThread model: posix\nInstalledDir: /usr/bin\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("whoway@ubuntu:~/llvmCookBook$ clang -emit-llvm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" multiply.c "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" multiply.ll\n\n clang "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-cc1")]),s._v(" -emit-llvm testfile.c "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" testfile.ll\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_1-5-将llvm-ir转换为bitcode「正面」"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-将llvm-ir转换为bitcode「正面」"}},[s._v("#")]),s._v(" 1.5.将LLVM_IR转换为bitcode「正面」")]),s._v(" "),a("p",[s._v("LLVM bitcode（也称为 字节码——bytecode）由两部分组成：")]),s._v(" "),a("ul",[a("li",[s._v("位流（bitstream，可类比字节流），以及")]),s._v(" "),a("li",[s._v("==将LLVM IR编码成位流的编码格式==")])]),s._v(" "),a("p",[s._v("前面自动安装了？")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("whoway@ubuntu:~/llvmCookBook$ llvm-as "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\nLLVM "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("http://llvm.org/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n  LLVM version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0\n  \n  Optimized build.\n  Default target: x86_64-pc-linux-gnu\n  Host CPU: broadwell\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("whoway@ubuntu:~/llvmCookBook$ llvm-as test.ll "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" test.bc\n\nwhoway@ubuntu:~/llvmCookBook$ hexdump "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-C")]),s._v(" test.bc \n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_1-6-将llvm-bitcode转换为目标平台汇编码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-将llvm-bitcode转换为目标平台汇编码"}},[s._v("#")]),s._v(" 1.6.将LLVM bitcode转换为目标平台汇编码")]),s._v(" "),a("ul",[a("li",[s._v("好像自动安装了，来自LLVM工具链的LLVM静态编译器llc。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("whoway@ubuntu:~/llvmCookBook$ llc test.bc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" test.s\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("==报错？==")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("whoway@ubuntu:~/llvmCookBook$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n01章.LLVM设计与使用  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".交叉编译  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.6")]),s._v(".将LLVM  bitcode转换为目标平台汇编码  test.bc  test.s\nwhoway@ubuntu:~/llvmCookBook$ clang "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" test.bc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" test.s -fomit-frame-pointer\nwarning: overriding the module target triple with x86_64-pc-linux-gnu "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-Woverride-module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" warning generated.\nwhoway@ubuntu:~/llvmCookBook$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n01章.LLVM设计与使用  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".交叉编译  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.6")]),s._v(".将LLVM  bitcode转换为目标平台汇编码  test.bc  test.s\nwhoway@ubuntu:~/llvmCookBook$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" test.s\nwhoway@ubuntu:~/llvmCookBook$ clang "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" test.bc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" test.s -fomit-frame-pointer\nwarning: overriding the module target triple with x86_64-pc-linux-gnu "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-Woverride-module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" warning generated.\nwhoway@ubuntu:~/llvmCookBook$ ll\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("\ndrwxrwxr-x  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" whoway whoway "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Apr  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":50 ./\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" whoway whoway "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Apr  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":42 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/\ndrwxrwxr-x  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" whoway whoway "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Apr  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":45 01章.LLVM设计与使用/\ndrwxrwxr-x  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" whoway whoway "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Apr  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":45 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".交叉编译/\ndrwxrwxr-x  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" whoway whoway "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Apr  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":46 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.6")]),s._v(".将LLVM/\ndrwxrwxr-x  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" whoway whoway "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Apr  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":46 bitcode转换为目标平台汇编码/\n-rw-rw-r--  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" whoway whoway "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1028")]),s._v(" Apr  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":47 test.bc\n-rw-rw-r--  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" whoway whoway  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("401")]),s._v(" Apr  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":50 test.s\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h3",{attrs:{id:"_1-7-将llvm-bitcode转回为llvm汇编码-也就是llvm-ir-「反面」"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-7-将llvm-bitcode转回为llvm汇编码-也就是llvm-ir-「反面」"}},[s._v("#")]),s._v(" 1.7.将LLVM bitcode转回为LLVM汇编码（==也就是llvm-IR==）「反面」")]),s._v(" "),a("ul",[a("li",[s._v("llvm-dis好像自动安装了")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("whoway@ubuntu:~/llvmCookBook$ llvm-dis test.bc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" test.ll\nwhoway@ubuntu:~/llvmCookBook$ l\n01章.LLVM设计与使用/  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".交叉编译/  test.bc  test.ll\nwhoway@ubuntu:~/llvmCookBook$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" test.ll\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" ModuleID "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test.bc'")]),s._v("\nsource_filename "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test.ll"')]),s._v("\n\ndefine i32 @mult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i32 %a, i32 %b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  %1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mul nsw i32 %a, %b\n  ret i32 %1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"_1-8-转换llvmir"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-8-转换llvmir"}},[s._v("#")]),s._v(" 1.8.转换LLVMIR")]),s._v(" "),a("p",[s._v("本节介绍使用opt工具把IR转换成其他形式，以及对IR代码实施的多个优化")]),s._v(" "),a("p",[s._v("框架如下")]),s._v(" "),a("div",{staticClass:"language-txt line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-txt"}},[a("code",[s._v("$opt –passname input.ll –o output.ll\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("whoway@ubuntu:~/llvmCookBook$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" multiply.c\nwhoway@ubuntu:~/llvmCookBook$ clang -emit-llvm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" multiply.c "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" multiply.ll\nwhoway@ubuntu:~/llvmCookBook$ opt-mem2reg "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" multiply.ll "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" multiply1.ll\nopt-mem2reg: "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" not found\nwhoway@ubuntu:~/llvmCookBook$ opt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-mem2reg")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" multiply.ll "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" multiply1.ll\n\n\nadce：入侵式无用代码消除。 \nbb-vectorize：基本块向量化。 \nconstprop：简单常量传播。 \ndce：无用代码消除。 \ndeadargelim：无用参数消除。 \nglobaldce：无用全局变量消除。 \nglobalopt：全局变量优化。 \ngvn：全局变量编号。\ninline：函数内联。 \ninstcombine：冗余指令合并。 \nlicm：循环常量代码外提。 \nloop-unswitch：循环外提。\nloweratomic：原子内建函数lowering。\nlowerinvoke：invode指令lowering，以支持不稳定的代码生成器。\nlowerswitch：switch指令lowering。 \nmem2reg：内存访问优化。 \nmemcpyopt：MemCpy优化。 \nsimplifycfg：简化CFG。\nsink：代码提升。 \ntailcallelim：尾调用消除。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("ul",[a("li",[s._v("要弄明白这些优化如何工作，你最好至少运行一些之前的Pass。")]),s._v(" "),a("li",[s._v("另外，如果想要得到这些Pass可应用的合适的源码，你可以到llvm/test/Transforms目录。对于以上的每一个Pass，在那里都可以看到测试代码。你可以应用相关Pass并查看测试代码如何被修改。")]),s._v(" "),a("li",[s._v("为了弄明白C语言代码是如何映射到LLVM IR的，你可以在将C代码转换为IR之后（在“将C源码转换为LLVM汇编码”一节提到），运行mem2reg Pass，它会帮助你明白C指令是如何映射到IR指令的。")])]),s._v(" "),a("h3",{attrs:{id:"_1-9-链接llvmbitcode"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-9-链接llvmbitcode"}},[s._v("#")]),s._v(" 1.9.链接LLVMbitcode")]),s._v(" "),a("ul",[a("li",[s._v("但==和传统的链接器不同，llvm-link不会链接 Object文件生成一个二进制文件==，它只链接bitcode文件")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("whoway@ubuntu:~/llvmCookBook$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" test1.c\nwhoway@ubuntu:~/llvmCookBook$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" test2.c\nwhoway@ubuntu:~/llvmCookBook$ clang -emit-llvm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" test1.c "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" test1.ll\nwhoway@ubuntu:~/llvmCookBook$ clang -emit-llvm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" test2.c "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" test2.ll\nwhoway@ubuntu:~/llvmCookBook$ llvm-as test1.ll "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" test1.bc\nwhoway@ubuntu:~/llvmCookBook$ llvm-as test2.ll "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" test2.bc\nwhoway@ubuntu:~/llvmCookBook$ llvm-link test1.bc  test2.bc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" output.bc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"_1-10-执行llvm-bitcode"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-10-执行llvm-bitcode"}},[s._v("#")]),s._v(" 1.10.执行LLVM bitcode")]),s._v(" "),a("p",[s._v("介绍如何==执行之前1.9==得到的LLVM bitcode文件。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("whoway@ubuntu:~/llvmCookBook$ lli output.bc \nnumber is "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("lli工具命令执行LLVM bitcode格式程序，它使用LLVM bitcode格式 作为输入并且使用**即时编译器（JIT）**执行。")]),s._v(" "),a("li",[s._v("当然，如果当前的架构不存在JIT编译器，会用解释器执行。")]),s._v(" "),a("li",[s._v("如果lli能够采用JIT编译器，那么它能高效地使用所有代码生成器参数，如==llc==。")])]),s._v(" "),a("p",[s._v("第3章为语言增加JIT支持并扩展前端和增加JIT支持部分")]),s._v(" "),a("h3",{attrs:{id:"_1-11-clang前端的不同用途⭐️"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-11-clang前端的不同用途⭐️"}},[s._v("#")]),s._v(" 1.11.clang前端的不同用途⭐️")]),s._v(" "),a("ul",[a("li",[s._v("Clang可以用作高层编译器驱动")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("whoway@ubuntu:~/llvmCookBook$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" test.c\nwhoway@ubuntu:~/llvmCookBook$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n01章.LLVM设计与使用  test.c\nwhoway@ubuntu:~/llvmCookBook$ clang test.c \nwhoway@ubuntu:~/llvmCookBook$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n01章.LLVM设计与使用  a.out  test.c\nwhoway@ubuntu:~/llvmCookBook$ ./a.out \nhello world\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("这里创建了C语言文件test.c，我们用Clang编译之后就得到可执行文件，将得到期望的结果。")])]),s._v(" "),a("li",[a("p",[s._v("E")])]),s._v(" "),a("li",[a("p",[s._v("使用以下命令调用"),a("strong",[s._v("预处理器")]),s._v("，在"),a("strong",[s._v("标准输出")]),s._v("中输出结果")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("whoway@ubuntu:~/llvmCookBook$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" test1.c\nwhoway@ubuntu:~/llvmCookBook$ clang test1.c "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-E")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 1 "test1.c"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 1 "<built-in>" 1')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 1 "<built-in>" 3')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 341 "<built-in>" 3')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 1 "<command line>" 1')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 1 "<built-in>" 2')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 1 "test1.c" 2')]),s._v("\n\nvoid "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("func")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n int a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nwhoway@ubuntu:~/llvmCookBook$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" test1.c \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#define MAX 100 ")]),s._v("\nvoid "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("func")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n\tint a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("MAX"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("ul",[a("li",[s._v("能用下面的命令打印前面样例中test.c（指的是那个"),a("strong",[s._v("有宏的")]),s._v("）文件的"),a("strong",[s._v("抽象语法树")]),s._v("，在标 准输出中输出结果")]),s._v(" "),a("li",[s._v("注意，是cc和一号，而不是L")]),s._v(" "),a("li",[s._v("这里的==-cc1参数保证了只运行编译器前端==，而不是编译器驱动，它输出了test.c文件代码的AST")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("whoway@ubuntu:~/llvmCookBook$ clang "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-cc1")]),s._v(" test.c -ast-dump\t\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("注意下面的命令，最后有个"),a("code",[s._v("-")]),s._v("符号")]),s._v(" "),a("li",[s._v("可以用下面的命令来为前面样例中的test.c文件生成==LLVM汇编码（也就是LLVM-IR）==：")]),s._v(" "),a("li",[s._v("如果你使用了"),a("code",[s._v("-o -")]),s._v("参数，则会在"),a("strong",[s._v("标准输出")]),s._v("中输出结果")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("clang test.c "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" -emit-llvm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" -\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"在之前的样例中-clang能够作为"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在之前的样例中-clang能够作为"}},[s._v("#")]),s._v(" 在之前的样例中，Clang能够作为")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("预处理器、⭐️")])]),s._v(" "),a("li",[a("p",[s._v("编译器驱动、⭐️")])]),s._v(" "),a("li",[a("p",[s._v("前端以及⭐️")])]),s._v(" "),a("li",[a("p",[s._v("代码生成器⭐️使用，因此它的输出取决于你指定的参数。")])])]),s._v(" "),a("p",[s._v("如果想要看到它的所有参数，可以执行clang的—help命令。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("clang "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-help")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_1-12-使用go语言前端llgo🧩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-12-使用go语言前端llgo🧩"}},[s._v("#")]),s._v(" 1.12.使用GO语言前端llgo🧩")]),s._v(" "),a("ul",[a("li",[s._v("==如何安装llgo呢？？==")]),s._v(" "),a("li",[s._v("下面是错误演示")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("whoway@ubuntu:~/llvmCookBook$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" test.go\n\nwhoway@ubuntu:~/llvmCookBook$ llgo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-dump")]),s._v(" test.go \n\nCommand "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'llgo'")]),s._v(" not found, did you mean:\n\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'lego'")]),s._v(" from deb lego "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.2")]),s._v(".0-1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'logo'")]),s._v(" from deb ucblogo "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.1")]),s._v("-0.1build1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nTry: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("deb name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\nwhoway@ubuntu:~/llvmCookBook$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" llgo\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sudo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" whoway: \nReading package lists"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". Done\nBuilding dependency tree       \nReading state information"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". Done\nE: Unable to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("locate")]),s._v(" package llgo\nwhoway@ubuntu:~/llvmCookBook$ \n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("ul",[a("li",[s._v("正确演示如下")]),s._v(" "),a("li",[s._v("https://github.com/go-llvm/llgo")]),s._v(" "),a("li",[s._v("关于llgo的源码下载及安装步骤⭐️⭐️⭐️⭐️⭐️⭐️")])]),s._v(" "),a("h3",{attrs:{id:"_1-13-使用dragonegg🧩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-13-使用dragonegg🧩"}},[s._v("#")]),s._v(" 1.13.使用DragonEgg🧩")]),s._v(" "),a("p",[s._v("DragonEgg是一个==GCC插件==，它使得GCC能够使用")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("LLVM优化器")]),s._v("和")]),s._v(" "),a("li",[a("strong",[s._v("代码生成器")])]),s._v(" "),a("li",[s._v("来取代GCC自己的优化器和代码生成器")])]),s._v(" "),a("p",[s._v("你需要==GCC 4.5及以上版本==，目标机器为x86-32/x86-64以及ARM处理器。")]),s._v(" "),a("p",[s._v("当然，也需要下载DragonEgg源码并构建==dragonegg.so动态链接库==文件。")]),s._v(" "),a("p",[s._v("==sysroot==：通常指的是系统的根目录，例如Linux系统的"),a("strong",[s._v("根目录")]),s._v(" "),a("strong",[s._v("为/")]),s._v("。有时我们可以通过修改sysroot来改变程序的安装路径。——译者\n注")]),s._v(" "),a("h2",{attrs:{id:"第2章-实现编译器前端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第2章-实现编译器前端"}},[s._v("#")]),s._v(" 第2章-实现编译器前端")]),s._v(" "),a("h2",{attrs:{id:"第3章-扩展前端并增加jit支持"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第3章-扩展前端并增加jit支持"}},[s._v("#")]),s._v(" 第3章-扩展前端并增加JIT支持")]),s._v(" "),a("p",[s._v("处理条件控制结构——if/then/else结构\n生成循环结构\n处理自定义二元运算符\n处理自定义一元运算符\n增加JIT支持")]),s._v(" "),a("h3",{attrs:{id:"_3-5-增加jit支持"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-增加jit支持"}},[s._v("#")]),s._v(" 3.5.增加JIT支持")]),s._v(" "),a("ul",[a("li",[s._v("JIT：==Just-In-Time，即时编译==，在程序运行时将代码翻译成机器码并执行。")]),s._v(" "),a("li",[s._v("与之相对的是AOT（"),a("strong",[s._v("Ahead Of Time")]),s._v("），它"),a("strong",[s._v("在程序运行之前就将代码编译成机器码")]),s._v("。JIT结合了==AOT==和==解释执行==的优势，它能够产生 高效的机器码，并具备足够的灵活性。——译者注")])]),s._v(" "),a("p",[s._v("如第1章所示，IR能够转成bitcode或者汇编语言。")]),s._v(" "),a("p",[s._v("一个叫作opt的优化工具也能作用于IR。")]),s._v(" "),a("p",[s._v("所以我 们通常把IR理解为一个通用的平台——这些工具的抽象层")]),s._v(" "),a("ul",[a("li",[s._v("==JIT==[1]支持也能在IR上运行。它能立即对输入的顶级表达式进行求值，例如你输入了1+2，它能对代码求值并输出运算结果3")]),s._v(" "),a("li",[s._v("LLVM的JIT编译器"),a("strong",[s._v("匹配本机")]),s._v("的==ABI平台==，它会把得到的指针转成相 应类型的函数指针，然后直接调用。JIT编译得到的代码与"),a("strong",[s._v("静态编译链接")]),s._v("的"),a("strong",[s._v("本地机器码")]),s._v("没有区别")])]),s._v(" "),a("h2",{attrs:{id:"第4章-准备优化⭐️"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第4章-准备优化⭐️"}},[s._v("#")]),s._v(" 第4章-准备优化⭐️")]),s._v(" "),a("p",[s._v("本章涵盖以下话题。\n多级优化\n自定义LLVM Pass\n使用opt工具运行自定义Pass\n在新的Pass中调用其他Pass\n使用Pass管理器注册Pass\n实现一个分析Pass\n实现一个别名分析Pass\n使用其他分析Pass")])])}),[],!1,null,null,null);a.default=e.exports}}]);